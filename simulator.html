<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>초구 시뮬레이터 & 경험치 계산기</title>
<link rel="shortcut icon" href="#">
<style>
  /* CSS 변수: 높이 통일 기준 */
  :root {
    --input-padding-y: 9px;
    --button-padding-y: 10px;
    --border-width: 1px;
    /* 폰트 크기 15px 기준, 총 높이 약 41px로 통일 */
  }

  body {background:#0b1426;color:#eaf2ff;font-family:"Pretendard",sans-serif;margin:0;padding:24px;text-align:center;}
  h1 {color:#ffd447;margin-bottom:20px;}
  
  /* [추가] 제목 이미지 스타일 */
  .title-icon {
    height: 30px; 
    vertical-align: middle;
    margin-right: 8px;
  }

  .tab-buttons{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
  .tab-buttons button{background:rgba(15,25,45,0.9);border:1px solid #ffd447;color:#ffd447;font-weight:700;border-radius:10px;padding:10px 20px;cursor:pointer;transition:all .2s ease;}
  .tab-buttons button.active{background:#ffd447;color:#111;}
  .tab-content{display:none;}
  .tab-content.active{display:block;}
  
  /* 전역 input 스타일 (다른 input에는 여전히 적용됨) */
  input{background:rgba(15,25,45,0.9);color:#fff;border:1px solid #3ba4f7;padding:10px 14px;border-radius:8px;width:260px;margin-bottom:10px;}
  
  /* 전역 button 스타일 */
  button{background:#ffd447;color:#111;font-weight:700;border:none;border-radius:8px;padding:10px 14px;cursor:pointer;margin:4px;transition:all .2s ease;}
  button:hover{filter:brightness(1.1);}
  
  /* 검색창 그룹 스타일 */
  .search-group {
    display: flex; /* Grid 대신 Flex를 사용하여 내부 정렬 유지 */
    justify-content: center;
    align-items: center; /* 수직 중앙 정렬 */
    gap: 8px;
    flex-wrap: wrap;
  }

  /* 검색 인풋 필드 */
  #petName {
    /* 기존 전역 스타일 재정의 */
    padding: 10px 10px; /* 기존 var(--input-padding-y) 대신 10px로 수정 (버튼과 높이 통일) */ 
    font-size: 15px;
    border: var(--border-width) solid #3ba4f7;
    border-radius: 8px;
    background: #1e2b40;
    color: #fff;
    box-sizing: border-box; /* 패딩과 테두리를 너비에 포함 */
    width: 260px;
    /* height: 제거 */
    margin-bottom: 0 !important; /* 컨테이너가 정렬을 맡으므로 마진 제거 */
  }

  /* 검색 버튼 */
  #btnSearch {
    /* 기존 전역 스타일 재정의 */
    padding: var(--button-padding-y) 14px;
    background: #3ba4f7;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    /* height: 제거 */
    margin: 0 !important; /* 컨테이너가 정렬을 맡으므로 마진 제거 */
  }
  
  .panel{margin-top:10px;background:rgba(15,25,45,0.9);border:1px solid #24324b;border-radius:10px;padding:10px;}
  /* .result 클래스에 display: none; 추가하여 처음에는 숨김 */
  .result{
    margin-top:15px;
    white-space:pre-line;
    text-align:left;
    display:none; /* 초기 숨김 */
    background:rgba(15,25,45,0.85);
    border-radius:10px;
    padding:14px;
    border:1px solid #24324b;
    font-family:"JetBrains Mono",monospace;
  }
  #costDisplay{margin-top:10px;color:#ffd447;font-weight:700;}
  .plus{color:#ff6b81;font-weight:700;}
  .minus{color:#3ba4f7;font-weight:700;}
  .zero{color:#a9b5cc;}
  /* 경험치 계산기 */
  .wrapper{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;max-width:900px;margin:auto;}
  .card{background:rgba(20,30,50,0.9);border:1px solid #24324b;border-radius:16px;padding:24px;box-shadow:0 0 12px rgba(25,60,100,.25);}
  label{color:#a9b5cc;font-weight:600;}
  .row{display:grid;gap:6px;margin:10px 0;}
  input[type="number"]{width:100%;padding:10px 12px;border:1px solid #3ba4f7;border-radius:10px;background:rgba(15,25,45,0.85);color:#fff;outline:none;font-size:15px;}
  .row.buttons{display:flex;justify-content:space-between;gap:10px;margin-top:12px;}
  .row.buttons button{flex:1;width:48%;padding:10px 0;border-radius:8px;font-weight:700;}
  .results{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:18px;}
  .stat{background:rgba(15,25,45,0.9);border:1px solid #24324b;border-radius:14px;padding:12px;text-align:center;}
  .stat small{display:block;color:#a9b5cc;}
  .stat strong{display:block;margin-top:4px;font-size:16px;color:#ffd447;}
  #visitCounter{margin-top:30px;font-weight:600;color:#ffd447;}
</style>
</head>
<body>
<h1><img src="https://raw.githubusercontent.com/potg123/potg123.github.io/main/reset.png" class="title-icon" alt="초기화 아이콘" />초구 시뮬레이터 & 경험치 계산기</h1>

<div class="tab-buttons">
  <button id="tabSim" class="active">🐾 초구 시뮬레이터</button>
  <button id="tabExp">📘 경험치 계산기</button>
  <button id="tabHome" onclick="location.href='index.html'">🏠 메인으로</button>
</div>

<div id="simTab" class="tab-content active">
  <div class="search-group">
    <input id="petName" placeholder="🔍 페트 이름을 입력해 주세요." />
    <button id="btnSearch">검색</button>
  </div>
  <div id="suggestions" style="margin-top:8px;"></div>
  <div id="sgrade" class="panel">페트를 입력하면 S급 기준 능력치가 표시됩니다.</div>
  <div style="margin-top:10px;">
    <button id="sim1">🎲 초기화 1회</button>
    <button id="sim5">🎲 초기화 5회</button>
    <button id="clear">🧹 결과 지우기</button>
  </div>
  <div id="costDisplay">💰 총 소모: 0원</div>
  <div id="result" class="result"></div>
</div>

<div id="expTab" class="tab-content">
  <div class="wrapper">
    <div class="card">
      <h2>📘 레벨업 경험치 계산기</h2>
      <div class="row"><label for="currentLevel">현재 레벨</label><input id="currentLevel" type="number" /></div>
      <div class="row"><label for="currentPercent">현재 진행도(%)</label><input id="currentPercent" type="number" placeholder="예: 45" /></div>
      <div class="row"><label for="targetLevel">목표 레벨</label><input id="targetLevel" type="number" /></div>
      <div class="row"><label for="xpPerHour">시간당 획득 경험치</label><input id="xpPerHour" type="number" /></div>
      <div class="row buttons">
        <button id="run">계산</button>
        <button id="reset">초기화</button>
      </div>
      <div class="results" id="results" hidden>
        <div class="stat"><small>남은 경험치</small><strong id="statRemain">-</strong></div>
        <div class="stat"><small>예상 시간</small><strong id="statHours">-</strong></div>
        <div class="stat"><small>예상 일수</small><strong id="statDays">-</strong></div>
      </div>
    </div>
  </div>
</div>

<div id="visitCounter">방문자 수 불러오는 중...</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const today = new Date();
  const dateKey = `${today.getFullYear()}_${today.getMonth()+1}_${today.getDate()}`;
  
  const pageKey = window.location.pathname === "/"
    ? `home_${dateKey}`
    : window.location.pathname.replace(/\W+/g, "_") + `_${dateKey}`;

  // 방문자 카운터는 그대로 유지
  fetch(`https://page-counter.dorangs30.workers.dev/hit/${pageKey}`)
    .then(res => res.json())
    .then(d => {
      document.getElementById("visitCounter").textContent =
        `👋 오늘 방문자 수 : ${d.value?.toLocaleString() ?? "0"}명`;
    })
    .catch(err => {
      console.error("방문자 카운터 에러:", err);
      document.getElementById("visitCounter").textContent = "방문자 수 로드 실패 😢";
    });

  /* ✅ 탭 전환 */
  const showTab = id => {
    document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-buttons button").forEach(b=>b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.getElementById(id==="simTab"?"tabSim":"tabExp").classList.add("active");
  };
  tabSim.onclick=()=>showTab("simTab");
  tabExp.onclick=()=>showTab("expTab");

  /* ✅ 펫 데이터 로드 (깃허브 Pages 자동 경로) */
  async function loadPetData(){
    const base = `${window.location.origin}/data/`; 
    // 경로 문제로 인해 로드가 안 될 경우, 이 부분을 위에서 제안한 GitHub URL로 임시 변경하여 시도해 보세요.
    // 예시: const base = `https://raw.githubusercontent.com/potg123/potg123.github.io/main/data/`;
    try{
      const pets = await fetch(base + "pets.json").then(r => r.json());
      console.log("✅ JSON 로드 완료:", Object.keys(pets).length);
      return pets;
    }catch(e){
      console.error("❌ JSON 불러오기 실패:",e);
      alert("펫 데이터를 불러오지 못했습니다.\n/data/pets.json 위치를 확인하세요. (브라우저 콘솔에서 CORS/Fetch 오류 확인)");
      return {pets:[],spet:[]};
    }
  }

  let PETS = {}, currentBase = null;
  const sgradeBox=document.getElementById("sgrade");
  const nameInput=document.getElementById("petName");
  const resultBox=document.getElementById("result");
  const costDisplay=document.getElementById("costDisplay");
  let totalCost=0;

  loadPetData().then(d => { PETS = d; });

  const safeName = s => (s || "").toLowerCase().trim();
  nameInput.onkeydown = e => { if(e.key === "Enter") updatePet(); };
  btnSearch.onclick = updatePet;
  nameInput.onchange = updatePet;

  function updatePet() {
    const n = safeName(nameInput.value);
    const sugBox = document.getElementById("suggestions");
    sugBox.innerHTML = ""; // 후보창 초기화

    if (!n) return;

    // 완전일치 먼저 확인
    let key = Object.keys(PETS).find(k => safeName(k) === n);
    if (!key) {
      const partial = Object.keys(PETS).filter(k => safeName(k).includes(n));
      if (partial.length === 1) key = partial[0];
      else if (partial.length > 1) {
        // 후보 여러 개면 버튼 목록 표시
        sugBox.innerHTML = `<div style="color:#3ba4f7;margin-bottom:6px;">🔍 여러 후보 (${partial.length}개):</div>`;
        partial.forEach(k => {
          const btn = document.createElement("button");
          btn.textContent = k;
          btn.style.background = "#24324b";
          btn.style.color = "#ffd447";
          btn.style.margin = "3px";
          btn.style.padding = "6px 12px";
          btn.style.borderRadius = "8px";
          btn.style.border = "1px solid #3ba4f7";
          btn.style.cursor = "pointer";
          btn.onclick = () => {
            nameInput.value = k;
            sugBox.innerHTML = "";
            showPetInfo(k);
          };
          sugBox.appendChild(btn);
        });
        currentBase = null;
        return;
      }
    }

    if (!key) {
      sgradeBox.innerHTML = `<b style="color:#ff6b81">⚠️ [${n}] 데이터 없음</b>`;
      currentBase = null;
      return;
    }

    showPetInfo(key);
  }

  function showPetInfo(key) {
    const s = PETS[key].s0;
    currentBase = { name: key, hp: s.hp, atk: s.atk, def: s.def, agi: s.agi };
    sgradeBox.innerHTML = `
      <b>${key} S급 기준</b><br>
      체력 <b>${s.hp}</b> | 공격력 <b>${s.atk}</b> | 방어력 <b>${s.def}</b> | 순발력 <b>${s.agi}</b>`;
  }

  function simulate(t=1){
    if(!currentBase){alert("펫 이름을 먼저 입력하세요.");return;}
    
    // 결과 출력 전, 결과창을 보이게 합니다.
    resultBox.style.display = "inline-block"; 

    resultBox.innerHTML="";
    let o=`\n<b>${currentBase.name} 시뮬레이션</b>\n────────────────────\n`;
  for(let i=1; i<=t; i++){
    const p = PETS[currentBase.name];
    if(!p || !p.u || !p.k){
      o += `<b>${i}회차</b> → ⚠️ 데이터 누락 (u/k 없음)<br>`;
      continue;
    }

    // ① 기본 성장 계수 불러오기 (복사)
    const tp = { ...p.u };
    // ② -2~+2 랜덤 추가
    tp.hp  += Math.floor(Math.random()*5) - 2;
    tp.atk += Math.floor(Math.random()*5) - 2;
    tp.def += Math.floor(Math.random()*5) - 2;
    tp.agi += Math.floor(Math.random()*5) - 2;

    // ③ 총 10포인트 랜덤 분배
    for(let j=0; j<10; j++){
      const r = Math.floor(Math.random()*4);
      if(r===0) tp.hp++;
      else if(r===1) tp.atk++;
      else if(r===2) tp.def++;
      else tp.agi++;
    }

    // ④ 초기치 계산 (level 1 → 앞항 소거)
    const base = {
      hp: p.k * tp.hp / 100,
      atk: p.k * tp.atk / 100,
      def: p.k * tp.def / 100,
      agi: p.k * tp.agi / 100
    };

    // ⑤ 표기 스탯 계산
    const shown = {
      hp: Math.floor(base.hp*4 + base.atk + base.def + base.agi),
      atk: Math.floor(base.hp*0.1 + base.atk + base.def*0.1 + base.agi*0.05),
      def: Math.floor(base.hp*0.1 + base.atk*0.1 + base.def + base.agi*0.05),
      agi: Math.floor(base.agi)
    };

    // ⑥ S급 기준값 (소수점 그대로 표시)
    const SstatRaw = p.s0 || { hp:0, atk:0, def:0, agi:0 };
    // ⑦ ± 계산용 S급 값 정수
    const SstatInt = {
      hp: Math.floor(SstatRaw.hp),
      atk: Math.floor(SstatRaw.atk),
      def: Math.floor(SstatRaw.def),
      agi: Math.floor(SstatRaw.agi)
    };

    // ⑧ ± 계산
    const delta = {
      hp: shown.hp - SstatInt.hp,
      atk: shown.atk - SstatInt.atk,
      def: shown.def - SstatInt.def,
      agi: shown.agi - SstatInt.agi
    };

    // ⑨ ± 표시 함수 (색상 적용, 0은 흰색)
    const formatDelta = n => {
      if(n > 0) return `<span style="color:red;">(+${n})</span>`;
      if(n < 0) return `<span style="color:blue;">(${n})</span>`;
      return `<span style="color:white;">(0)</span>`;
    };

    // ⑩ 출력 (S급 소수점 그대로, 결과 스탯과 ± 정수)
    o += `<b>${i}회차</b> → `
      + `체력 <b>${shown.hp}</b> ${formatDelta(delta.hp)} | `
      + `공격력 <b>${shown.atk}</b> ${formatDelta(delta.atk)} | `
      + `방어력 <b>${shown.def}</b> ${formatDelta(delta.def)} | `
      + `순발력 <b>${shown.agi}</b> ${formatDelta(delta.agi)}<br>`;
  }
  resultBox.innerHTML=o;
}

  sim1.onclick=()=>{simulate(1);totalCost+=1000;costDisplay.textContent=`💰 총 소모: ${totalCost.toLocaleString()}원`;};
  sim5.onclick=()=>{simulate(5);totalCost+=5000;costDisplay.textContent=`💰 총 소모: ${totalCost.toLocaleString()}원`;};
  clear.onclick=()=>{
    resultBox.innerHTML="";
    totalCost=0;
    costDisplay.textContent="💰 총 소모: 0원";
    // 결과 지우기 시 결과창 숨김
    resultBox.style.display="none"; 
  };

  /* ✅ 경험치 계산기 */
  const $=s=>document.querySelector(s);
  const fmtNum=n=>isFinite(n)?Number(n).toLocaleString():"-";
    const EXP_TABLE={1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,
  14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,24:5885,
  25:6635,26:7447,27:8321,28:9263,29:10272,30:11352,31:12506,32:13734,33:15042,34:16429,
  35:17899,36:19454,37:21098,38:22830,39:24656,40:26576,41:28594,42:30710,43:32930,44:35253,
  45:37683,46:40222,47:42874,48:45638,49:48520,50:51520,51:54642,52:57886,53:61258,54:64757,
  55:68387,56:72150,57:76050,58:80086,59:84264,60:106110,61:113412,62:121149,63:129352,
  64:138044,65:147256,66:157019,67:167366,68:178334,69:189958,70:202282,71:215348,72:229205,
  73:243901,74:259495,75:276041,76:293606,77:312258,78:332071,79:353126,80:375511,81:399318,
  82:424655,83:451631,84:480370,85:511007,86:543686,87:578571,88:616838,89:655680,90:698312,
  91:743970,92:795918,93:842442,94:901869,95:962553,96:1026899,97:1098354,98:1174419,99:1256664,
  100:1407463,101:1576358,102:1765521,103:1977384,104:2214670,105:2480430,106:2778082,107:3111451,
  108:3484825,109:3903005,110:4371365,111:4895929,112:5483440,113:6141453,114:6878428,115:7703839,
  116:8628300,117:9663695,118:10823339,119:12122140,120:13576796,121:15206012,122:17030733,
  123:19074421,124:21363352,125:23926954,126:26798189,127:30013971,128:33615648,129:37649526,
  130:42167469,131:47227565,132:52894873,133:59242257,134:66351328,135:74313488,136:83231106,
  137:93218839,138:104405100,139:116933712};
  const getTotalExp=(s,t)=>{let sum=0;for(let lv=s;lv<t;lv++)if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];return sum;};
  $("#run").onclick=()=>{
    try{
      const c=+$("#currentLevel").value,cp=+($("#currentPercent").value)||0,t=+$("#targetLevel").value,ph=+$("#xpPerHour").value;
      if(!c||!t||!ph)throw new Error("입력이 부족합니다.");
      if(t<=c)throw new Error("목표 레벨은 현재보다 커야 합니다.");
      const rem1=EXP_TABLE[c]*(1-(cp/100)),rem2=getTotalExp(c+1,t),remain=rem1+rem2;
      const hrs=remain/ph,days=hrs/24,h=Math.floor(hrs),m=Math.round((hrs-h)*60);
      $("#statRemain").textContent=fmtNum(remain.toFixed(0));
      $("#statHours").textContent=`${h}시간 ${m}분`;
      $("#statDays").textContent=days.toFixed(2)+" 일";
      $("#results").hidden=false;
    }catch(e){alert(e.message);}
  };
  $("#reset").onclick=()=>{document.querySelectorAll("#expTab input").forEach(i=>i.value="");$("#results").hidden=true;};
});
</script>
</body>
</html>
